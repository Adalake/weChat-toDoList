"use strict";
var util = require("../../utils/util.js");
var app = getApp();
var context;
Page({
    data: {
        motto: "to do list",
        userInfo: {},
        hasUserInfo: false,
        canIUse: wx.canIUse("button.open-type.getUserInfo"),
        addShow: false,
        addText: "",
        status: "1",
        focus: false,
        lists: [],
        curLists: [],
        books: [],
        editIndex: 0,
        delBtnWidth: 120,
        curDay: "",
        addUserInfo: "",
        studyStatus: 0,
        lastId: "",
    },
    studyDone: function () {
        var db = wx.cloud.database();
        if (context.data.studyStatus === 0) {
            context.setData({
                studyStatus: 1,
            });
            db.collection("todolist").add({
                data: {
                    done: true,
                    userId: "test userId in radio",
                    curDay: context.data.curDay,
                },
                success: function (res) {
                    context.setData({
                        lastId: res["_id"],
                    }),
                        wx.showToast({
                            title: "今日学习打卡",
                        });
                },
            });
        }
        else {
            wx.showModal({
                title: "删除今天的打卡",
                content: "您确定要删除今天的打卡吗？",
                confirmText: "确认删除",
                cancelText: "取消",
                success: function (res) {
                    if (res.confirm) {
                        db
                            .collection("todolist")
                            .doc(context.data.lastId)
                            .remove({
                            success: function () {
                                wx.showToast({
                                    title: "删除成功",
                                });
                            },
                        }),
                            context.setData({
                                studyStatus: 0,
                            });
                        console.log("用户确认删除");
                    }
                    else {
                        console.log("用户取消了操作");
                    }
                },
            });
        }
    },
    bindViewTap: function () {
        wx.navigateTo({
            url: "../logs/logs",
        });
    },
    onLoad: function () {
        var _this = this;
        context = this;
        var db = wx.cloud.database();
        db.collection("todolist").get({
            success: function (e) {
                if (e.data[e.data.length - 1]["curDay"] === getDay) {
                    context.setData({
                        studyStatus: 1,
                        lastId: e.data[e.data.length - 1]["_id"],
                    });
                }
            },
        });
        var time = util.formatTime(new Date());
        var getDay = time.split(" ")[0];
        this.setData({
            curDay: getDay,
        });
        console.log(context.curDay, "today");
        wx.getStorage({
            key: "lists",
            success: function (res) {
                console.log(res.data);
                context.setData({
                    lists: res.data,
                    curLists: res.data,
                });
            },
        });
        if (app.globalData.userInfo) {
            this.setData({
                userInfo: app.globalData.userInfo,
                hasUserInfo: true,
            });
        }
        else if (this.data.canIUse) {
            app.userInfoReadyCallback = function (res) {
                _this.setData({
                    userInfo: res.userInfo,
                    hasUserInfo: true,
                });
            };
        }
        else {
            wx.getUserInfo({
                success: function (res) {
                    app.globalData.userInfo = res.userInfo;
                    _this.setData({
                        userInfo: res.userInfo,
                        hasUserInfo: true,
                    });
                },
            });
        }
    },
    getUserInfo: function (e) {
        app.globalData.userInfo = e.detail.userInfo;
        this.setData({
            userInfo: e.detail.userInfo,
            hasUserInfo: true,
        });
    },
    addTodoShow: function () {
        context.setData({
            addShow: true,
            focus: true,
        });
    },
    addTodo: function () {
        if (!context.data.addText.trim()) {
            return;
        }
        var temp = context.data.lists;
        var addT = {
            id: new Date().getTime(),
            title: context.data.addText,
            status: "0",
        };
        temp.push(addT);
        context.showCur(temp);
        context.addTodoHide();
        wx.setStorage({
            key: "lists",
            data: temp,
        });
        wx.showToast({
            title: "添加成功! 23",
            icon: "success",
            duration: 1000,
        });
    },
    addTodoHide: function () {
        context.setData({
            addShow: false,
            focus: false,
            addText: "",
        });
    },
    showCur: function (data) {
        if (data.status === "1") {
            context.setData({
                lists: data,
                curLists: data,
            });
        }
        else {
            context.setData({
                lists: data,
                curLists: data.filter(function (item) { return +item.status === context.data.status - 2; }),
            });
        }
    },
    changeTodo: function (e) {
        var item = e.currentTarget.dataset.item;
        var temp = context.data.lists;
        temp.forEach(function (el) {
            if (el.id === item) {
                if (el.status === "0") {
                    el.status = "1";
                    context.showCur(temp);
                    wx.setStorage({
                        key: "lists",
                        data: temp,
                    });
                    wx.showToast({
                        title: "已完成任务",
                        icon: "success",
                        duration: 1000,
                    });
                }
                else {
                    wx.showModal({
                        title: "",
                        content: "该任务已完成，确定重新开始任务？",
                        confirmText: "确定",
                        cancelText: "不了",
                        success: function (res) {
                            if (res.confirm) {
                                el.status = "0";
                                context.showCur(temp);
                                wx.setStorage({
                                    key: "lists",
                                    data: temp,
                                });
                            }
                            else {
                                return console.log("不操作");
                            }
                        },
                    });
                }
            }
        });
        console.log(item);
    },
    setInput: function (e) {
        context.setData({
            addText: e.detail.value,
        });
    },
    setUser: function (e) {
        context.setData({
            addUserInfo: e.detail.value,
        });
    },
    addUser: function () {
        var db = wx.cloud.database();
        console.log(context.data.addUserInfo);
        if (context.data.addUserInfo === "test 2")
            db.collection("todolist").add({
                data: {
                    openid: context.data.addUserInfo,
                    done: true,
                    curDay: context.data.curDay,
                },
                success: function () {
                    wx.showToast({
                        title: "邀请码验证成功",
                    });
                },
            });
    },
    showStatus: function (e) {
        var st = e.currentTarget.dataset.status;
        if (context.data.status === st)
            return;
        if (st === "1") {
            context.setData({
                status: st,
                curLists: context.data.lists,
            });
            return;
        }
        context.setData({
            status: st,
            curLists: context.data.lists.filter(function (item) { return +item.status === st - 2; }),
        });
    },
    delTodo: function (e) {
        var item = e.currentTarget.dataset.item;
        var temp = context.data.lists;
        temp.forEach(function (el, index) {
            if (el.id === item) {
                temp[index].txtStyle = "left:0";
                wx.showModal({
                    title: "",
                    content: "您确定要删除吗？",
                    confirmText: "确定",
                    cancelText: "考虑一下",
                    success: function (res) {
                        if (res.confirm) {
                            temp.splice(index, 1);
                            context.showCur(temp);
                            wx.setStorage({
                                key: "lists",
                                data: temp,
                            });
                        }
                        else {
                            context.showCur(temp);
                            return console.log("不操作");
                        }
                    },
                });
            }
        });
    },
    touchS: function (e) {
        if (e.touches.length === 1) {
            context.setData({
                startX: e.touches[0].clientX,
            });
        }
    },
    touchM: function (e) {
        if (e.touches.length === 1) {
            var moveX = e.touches[0].clientX;
            var disX = context.data.startX - moveX;
            var delBtnWidth = context.data.delBtnWidth;
            var txtStyle = "";
            if (disX == 0 || disX < 0) {
                txtStyle = "left:0";
            }
            else if (disX > 0) {
                txtStyle = "left:-" + disX + "rpx";
                if (disX >= delBtnWidth) {
                    txtStyle = "left:-" + delBtnWidth + "rpx";
                }
            }
            var index = e.currentTarget.dataset.index;
            var list = context.data.curLists;
            list[index].txtStyle = txtStyle;
            context.setData({
                curLists: list,
            });
        }
    },
    touchE: function (e) {
        if (e.changedTouches.length === 1) {
            var endX = e.changedTouches[0].clientX;
            var disX = context.data.startX - endX;
            var delBtnWidth = context.data.delBtnWidth;
            var txtStyle = disX > delBtnWidth / 2 ? "left:-" + delBtnWidth + "rpx" : "left:0";
            var index = e.currentTarget.dataset.index;
            var list = context.data.curLists;
            list[index].txtStyle = txtStyle;
            context.setData({
                curLists: list,
            });
        }
    },
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJpbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBTUEsSUFBSSxJQUFJLEdBQUcsT0FBTyxDQUFDLHFCQUFxQixDQUFDLENBQUM7QUFFMUMsSUFBTSxHQUFHLEdBQUcsTUFBTSxFQUFjLENBQUM7QUFDakMsSUFBSSxPQUFZLENBQUM7QUFDakIsSUFBSSxDQUFDO0lBQ0gsSUFBSSxFQUFFO1FBQ0osS0FBSyxFQUFFLFlBQVk7UUFDbkIsUUFBUSxFQUFFLEVBQUU7UUFDWixXQUFXLEVBQUUsS0FBSztRQUNsQixPQUFPLEVBQUUsRUFBRSxDQUFDLE9BQU8sQ0FBQyw4QkFBOEIsQ0FBQztRQUNuRCxPQUFPLEVBQUUsS0FBSztRQUNkLE9BQU8sRUFBRSxFQUFFO1FBQ1gsTUFBTSxFQUFFLEdBQUc7UUFDWCxLQUFLLEVBQUUsS0FBSztRQUNaLEtBQUssRUFBRSxFQUFtQjtRQUMxQixRQUFRLEVBQUUsRUFBRTtRQUNaLEtBQUssRUFBRSxFQUFFO1FBQ1QsU0FBUyxFQUFFLENBQUM7UUFDWixXQUFXLEVBQUUsR0FBRztRQUNoQixNQUFNLEVBQUUsRUFBRTtRQUNWLFdBQVcsRUFBRSxFQUFFO1FBQ2YsV0FBVyxFQUFFLENBQUM7UUFDZCxNQUFNLEVBQUUsRUFBRTtLQUNYO0lBR0QsU0FBUyxFQUFFO1FBQ1QsSUFBTSxFQUFFLEdBQUcsRUFBRSxDQUFDLEtBQUssQ0FBQyxRQUFRLEVBQUUsQ0FBQztRQUMvQixJQUFJLE9BQU8sQ0FBQyxJQUFJLENBQUMsV0FBVyxLQUFLLENBQUMsRUFBRTtZQUNsQyxPQUFPLENBQUMsT0FBTyxDQUFDO2dCQUNkLFdBQVcsRUFBRSxDQUFDO2FBQ2YsQ0FBQyxDQUFDO1lBQ0gsRUFBRSxDQUFDLFVBQVUsQ0FBQyxVQUFVLENBQUMsQ0FBQyxHQUFHLENBQUM7Z0JBQzVCLElBQUksRUFBRTtvQkFDSixJQUFJLEVBQUUsSUFBSTtvQkFDVixNQUFNLEVBQUUsc0JBQXNC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QUFHLE9BQU8sQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDO1lBRTNDLElBQUksUUFBUSxHQUNWLElBQUksR0FBRyxXQUFXLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxRQUFRLEdBQUcsV0FBVyxHQUFHLEtBQUssQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDO1lBRXJFLElBQUksS0FBSyxHQUFHLENBQUMsQ0FBQyxhQUFhLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQztZQUMxQyxJQUFJLElBQUksR0FBRyxPQUFPLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQztZQUNqQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsUUFBUSxHQUFHLFFBQVEsQ0FBQztZQUVoQyxPQUFPLENBQUMsT0FBTyxDQUFDO2dCQUNkLFFBQVEsRUFBRSxJQUFJO2FBQ2YsQ0FBQyxDQUFDO1NBQ0o7SUFDSCxDQUFDO0NBQ0YsQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLy8gaW5kZXgudHNcbi8vIOiOt+WPluW6lOeUqOWunuS+i1xuXG4vLyBUT0RPIHN0ZXAgMDog6L6T5YWl6YKA6K+356CB6aqM6K+B77yM6L+Z5qC35bCx5Y+v5Lul5oyJ6YKA6K+356CB5ouJ5Ye66K+l55So5oi355qE5omT5Y2h5pe26Ze0XG4vLyBUT0RPIHN0ZXAgMTog5omT5Yu+77yM5ZCR5pWw5o2u5bqT5o+S5YWl5LiA5p2h5raI5oGvXG4vLyBUT0RPIHN0ZXAgMjog5LuO5pWw5o2u5bqT5p+l6K+i5omA5pyJ5raI5oGv77yM5bm25bGV56S65Yiw6aG16Z2iXG52YXIgdXRpbCA9IHJlcXVpcmUoXCIuLi8uLi91dGlscy91dGlsLmpzXCIpO1xuXG5jb25zdCBhcHAgPSBnZXRBcHA8SUFwcE9wdGlvbj4oKTtcbmxldCBjb250ZXh0OiBhbnk7XG5QYWdlKHtcbiAgZGF0YToge1xuICAgIG1vdHRvOiBcInRvIGRvIGxpc3RcIixcbiAgICB1c2VySW5mbzoge30sXG4gICAgaGFzVXNlckluZm86IGZhbHNlLFxuICAgIGNhbklVc2U6IHd4LmNhbklVc2UoXCJidXR0b24ub3Blbi10eXBlLmdldFVzZXJJbmZvXCIpLFxuICAgIGFkZFNob3c6IGZhbHNlLFxuICAgIGFkZFRleHQ6IFwiXCIsXG4gICAgc3RhdHVzOiBcIjFcIixcbiAgICBmb2N1czogZmFsc2UsXG4gICAgbGlzdHM6IFtdIGFzIEFycmF5PHN0cmluZz4sXG4gICAgY3VyTGlzdHM6IFtdLFxuICAgIGJvb2tzOiBbXSxcbiAgICBlZGl0SW5kZXg6IDAsXG4gICAgZGVsQnRuV2lkdGg6IDEyMCxcbiAgICBjdXJEYXk6IFwiXCIsXG4gICAgYWRkVXNlckluZm86IFwiXCIsXG4gICAgc3R1ZHlTdGF0dXM6IDAsXG4gICAgbGFzdElkOiBcIlwiLFxuICB9LFxuICAvLyDkuovku7blpITnkIblh73mlbBcblxuICBzdHVkeURvbmU6ICgpID0+IHtcbiAgICBjb25zdCBkYiA9IHd4LmNsb3VkLmRhdGFiYXNlKCk7XG4gICAgaWYgKGNvbnRleHQuZGF0YS5zdHVkeVN0YXR1cyA9PT0gMCkge1xuICAgICAgY29udGV4dC5zZXREYXRhKHtcbiAgICAgICAgc3R1ZHlTdGF0dXM6IDEsXG4gICAgICB9KTtcbiAgICAgIGRiLmNvbGxlY3Rpb24oXCJ0b2RvbGlzdFwiKS5hZGQoe1xuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgZG9uZTogdHJ1ZSxcbiAgICAgICAgICB1c2VySWQ6IFwidGVzdCB1c2VySWQgaW4gcmFkaW9cIixcbiAgICAgICAgICBjdXJEYXk6IGNvbnRleHQuZGF0YS5jdXJEYXksXG4gICAgICAgIH0sXG4gICAgICAgIHN1Y2Nlc3M6IChyZXM6IGFueSkgPT4ge1xuICAgICAgICAgIGNvbnRleHQuc2V0RGF0YSh7XG4gICAgICAgICAgICBsYXN0SWQ6IHJlc1tcIl9pZFwiXSxcbiAgICAgICAgICB9KSxcbiAgICAgICAgICAgIHd4LnNob3dUb2FzdCh7XG4gICAgICAgICAgICAgIHRpdGxlOiBcIuS7iuaXpeWtpuS5oOaJk+WNoVwiLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgd3guc2hvd01vZGFsKHtcbiAgICAgICAgdGl0bGU6IFwi5Yig6Zmk5LuK5aSp55qE5omT5Y2hXCIsXG4gICAgICAgIGNvbnRlbnQ6IFwi5oKo56Gu5a6a6KaB5Yig6Zmk5LuK5aSp55qE5omT5Y2h5ZCX77yfXCIsXG4gICAgICAgIGNvbmZpcm1UZXh0OiBcIuehruiupOWIoOmZpFwiLFxuICAgICAgICBjYW5jZWxUZXh0OiBcIuWPlua2iFwiLFxuICAgICAgICBzdWNjZXNzOiAocmVzOiBhbnkpID0+IHtcbiAgICAgICAgICBpZiAocmVzLmNvbmZpcm0pIHtcbiAgICAgICAgICAgIGRiXG4gICAgICAgICAgICAgIC5jb2xsZWN0aW9uKFwidG9kb2xpc3RcIilcbiAgICAgICAgICAgICAgLmRvYyhjb250ZXh0LmRhdGEubGFzdElkKVxuICAgICAgICAgICAgICAucmVtb3ZlKHtcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICB3eC5zaG93VG9hc3Qoe1xuICAgICAgICAgICAgICAgICAgICB0aXRsZTogXCLliKDpmaTmiJDlip9cIixcbiAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICBjb250ZXh0LnNldERhdGEoe1xuICAgICAgICAgICAgICAgIHN0dWR5U3RhdHVzOiAwLFxuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwi55So5oi356Gu6K6k5Yig6ZmkXCIpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIueUqOaIt+WPlua2iOS6huaTjeS9nFwiKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICB9XG4gIH0sXG5cbiAgYmluZFZpZXdUYXAoKSB7XG4gICAgd3gubmF2aWdhdGVUbyh7XG4gICAgICB1cmw6IFwiLi4vbG9ncy9sb2dzXCIsXG4gICAgfSk7XG4gIH0sXG5cbiAgb25Mb2FkKCkge1xuICAgIC8vIOi9rOWMluWFqOWxgOeahHRoaXNcbiAgICBjb250ZXh0ID0gdGhpcztcbiAgICAvLyDojrflj5bmlbDmja7lupPmlbDmja5cbiAgICBjb25zdCBkYiA9IHd4LmNsb3VkLmRhdGFiYXNlKCk7XG4gICAgZGIuY29sbGVjdGlvbihcInRvZG9saXN0XCIpLmdldCh7XG4gICAgICBzdWNjZXNzOiAoZTogYW55KSA9PiB7XG4gICAgICAgIGlmIChlLmRhdGFbZS5kYXRhLmxlbmd0aCAtIDFdW1wiY3VyRGF5XCJdID09PSBnZXREYXkpIHtcbiAgICAgICAgICBjb250ZXh0LnNldERhdGEoe1xuICAgICAgICAgICAgc3R1ZHlTdGF0dXM6IDEsXG4gICAgICAgICAgICBsYXN0SWQ6IGUuZGF0YVtlLmRhdGEubGVuZ3RoIC0gMV1bXCJfaWRcIl0sXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgfSk7XG4gICAgLy8g6I635Y+W5LuK5aSp55qE5pe26Ze0XG4gICAgbGV0IHRpbWUgPSB1dGlsLmZvcm1hdFRpbWUobmV3IERhdGUoKSk7XG4gICAgY29uc3QgZ2V0RGF5ID0gdGltZS5zcGxpdChcIiBcIilbMF07XG4gICAgdGhpcy5zZXREYXRhKHtcbiAgICAgIGN1ckRheTogZ2V0RGF5LFxuICAgIH0pO1xuICAgIGNvbnNvbGUubG9nKGNvbnRleHQuY3VyRGF5LCBcInRvZGF5XCIpO1xuXG4gICAgd3guZ2V0U3RvcmFnZSh7XG4gICAgICBrZXk6IFwibGlzdHNcIixcbiAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChyZXMpIHtcbiAgICAgICAgY29uc29sZS5sb2cocmVzLmRhdGEpO1xuICAgICAgICBjb250ZXh0LnNldERhdGEoe1xuICAgICAgICAgIGxpc3RzOiByZXMuZGF0YSxcbiAgICAgICAgICBjdXJMaXN0czogcmVzLmRhdGEsXG4gICAgICAgIH0pO1xuICAgICAgfSxcbiAgICB9KTtcblxuICAgIGlmIChhcHAuZ2xvYmFsRGF0YS51c2VySW5mbykge1xuICAgICAgdGhpcy5zZXREYXRhKHtcbiAgICAgICAgdXNlckluZm86IGFwcC5nbG9iYWxEYXRhLnVzZXJJbmZvLFxuICAgICAgICBoYXNVc2VySW5mbzogdHJ1ZSxcbiAgICAgIH0pO1xuICAgIH0gZWxzZSBpZiAodGhpcy5kYXRhLmNhbklVc2UpIHtcbiAgICAgIC8vIOeUseS6jiBnZXRVc2VySW5mbyDmmK/nvZHnu5zor7fmsYLvvIzlj6/og73kvJrlnKggUGFnZS5vbkxvYWQg5LmL5ZCO5omN6L+U5ZueXG4gICAgICAvLyDmiYDku6XmraTlpITliqDlhaUgY2FsbGJhY2sg5Lul6Ziy5q2i6L+Z56eN5oOF5Ya1XG4gICAgICBhcHAudXNlckluZm9SZWFkeUNhbGxiYWNrID0gKHJlcykgPT4ge1xuICAgICAgICB0aGlzLnNldERhdGEoe1xuICAgICAgICAgIHVzZXJJbmZvOiByZXMudXNlckluZm8sXG4gICAgICAgICAgaGFzVXNlckluZm86IHRydWUsXG4gICAgICAgIH0pO1xuICAgICAgfTtcbiAgICB9IGVsc2Uge1xuICAgICAgLy8g5Zyo5rKh5pyJIG9wZW4tdHlwZT1nZXRVc2VySW5mbyDniYjmnKznmoTlhbzlrrnlpITnkIZcbiAgICAgIHd4LmdldFVzZXJJbmZvKHtcbiAgICAgICAgc3VjY2VzczogKHJlcykgPT4ge1xuICAgICAgICAgIGFwcC5nbG9iYWxEYXRhLnVzZXJJbmZvID0gcmVzLnVzZXJJbmZvO1xuICAgICAgICAgIHRoaXMuc2V0RGF0YSh7XG4gICAgICAgICAgICB1c2VySW5mbzogcmVzLnVzZXJJbmZvLFxuICAgICAgICAgICAgaGFzVXNlckluZm86IHRydWUsXG4gICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICB9XG4gIH0sXG5cbiAgZ2V0VXNlckluZm8oZTogYW55KSB7XG4gICAgYXBwLmdsb2JhbERhdGEudXNlckluZm8gPSBlLmRldGFpbC51c2VySW5mbztcbiAgICB0aGlzLnNldERhdGEoe1xuICAgICAgdXNlckluZm86IGUuZGV0YWlsLnVzZXJJbmZvLFxuICAgICAgaGFzVXNlckluZm86IHRydWUsXG4gICAgfSk7XG4gIH0sXG5cbiAgYWRkVG9kb1Nob3c6ICgpID0+IHtcbiAgICBjb250ZXh0LnNldERhdGEoe1xuICAgICAgYWRkU2hvdzogdHJ1ZSxcbiAgICAgIGZvY3VzOiB0cnVlLFxuICAgIH0pO1xuICB9LFxuXG4gIGFkZFRvZG86ICgpID0+IHtcbiAgICBpZiAoIWNvbnRleHQuZGF0YS5hZGRUZXh0LnRyaW0oKSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBsZXQgdGVtcCA9IGNvbnRleHQuZGF0YS5saXN0cztcbiAgICBsZXQgYWRkVDogYW55ID0ge1xuICAgICAgaWQ6IG5ldyBEYXRlKCkuZ2V0VGltZSgpLFxuICAgICAgdGl0bGU6IGNvbnRleHQuZGF0YS5hZGRUZXh0LFxuICAgICAgc3RhdHVzOiBcIjBcIixcbiAgICB9O1xuICAgIHRlbXAucHVzaChhZGRUKTtcbiAgICBjb250ZXh0LnNob3dDdXIodGVtcCk7XG4gICAgY29udGV4dC5hZGRUb2RvSGlkZSgpO1xuICAgIHd4LnNldFN0b3JhZ2Uoe1xuICAgICAga2V5OiBcImxpc3RzXCIsXG4gICAgICBkYXRhOiB0ZW1wLFxuICAgIH0pO1xuICAgIHd4LnNob3dUb2FzdCh7XG4gICAgICB0aXRsZTogXCLmt7vliqDmiJDlip8hIDIzXCIsXG4gICAgICBpY29uOiBcInN1Y2Nlc3NcIixcbiAgICAgIGR1cmF0aW9uOiAxMDAwLFxuICAgIH0pO1xuICB9LFxuXG4gIGFkZFRvZG9IaWRlOiAoKSA9PiB7XG4gICAgY29udGV4dC5zZXREYXRhKHtcbiAgICAgIGFkZFNob3c6IGZhbHNlLFxuICAgICAgZm9jdXM6IGZhbHNlLFxuICAgICAgYWRkVGV4dDogXCJcIixcbiAgICB9KTtcbiAgfSxcblxuICBzaG93Q3VyOiAoZGF0YTogYW55KSA9PiB7XG4gICAgaWYgKGRhdGEuc3RhdHVzID09PSBcIjFcIikge1xuICAgICAgY29udGV4dC5zZXREYXRhKHtcbiAgICAgICAgbGlzdHM6IGRhdGEsXG4gICAgICAgIGN1ckxpc3RzOiBkYXRhLFxuICAgICAgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnRleHQuc2V0RGF0YSh7XG4gICAgICAgIGxpc3RzOiBkYXRhLFxuICAgICAgICBjdXJMaXN0czogZGF0YS5maWx0ZXIoXG4gICAgICAgICAgKGl0ZW06IGFueSkgPT4gK2l0ZW0uc3RhdHVzID09PSBjb250ZXh0LmRhdGEuc3RhdHVzIC0gMlxuICAgICAgICApLFxuICAgICAgfSk7XG4gICAgfVxuICB9LFxuXG4gIGNoYW5nZVRvZG86IChlOiBhbnkpID0+IHtcbiAgICBsZXQgaXRlbSA9IGUuY3VycmVudFRhcmdldC5kYXRhc2V0Lml0ZW07XG4gICAgbGV0IHRlbXAgPSBjb250ZXh0LmRhdGEubGlzdHM7XG4gICAgdGVtcC5mb3JFYWNoKChlbDogYW55KSA9PiB7XG4gICAgICBpZiAoZWwuaWQgPT09IGl0ZW0pIHtcbiAgICAgICAgaWYgKGVsLnN0YXR1cyA9PT0gXCIwXCIpIHtcbiAgICAgICAgICBlbC5zdGF0dXMgPSBcIjFcIjtcbiAgICAgICAgICBjb250ZXh0LnNob3dDdXIodGVtcCk7XG4gICAgICAgICAgd3guc2V0U3RvcmFnZSh7XG4gICAgICAgICAgICBrZXk6IFwibGlzdHNcIixcbiAgICAgICAgICAgIGRhdGE6IHRlbXAsXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgd3guc2hvd1RvYXN0KHtcbiAgICAgICAgICAgIHRpdGxlOiBcIuW3suWujOaIkOS7u+WKoVwiLFxuICAgICAgICAgICAgaWNvbjogXCJzdWNjZXNzXCIsXG4gICAgICAgICAgICBkdXJhdGlvbjogMTAwMCxcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB3eC5zaG93TW9kYWwoe1xuICAgICAgICAgICAgdGl0bGU6IFwiXCIsXG4gICAgICAgICAgICBjb250ZW50OiBcIuivpeS7u+WKoeW3suWujOaIkO+8jOehruWumumHjeaWsOW8gOWni+S7u+WKoe+8n1wiLFxuICAgICAgICAgICAgY29uZmlybVRleHQ6IFwi56Gu5a6aXCIsXG4gICAgICAgICAgICBjYW5jZWxUZXh0OiBcIuS4jeS6hlwiLFxuICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKHJlcykge1xuICAgICAgICAgICAgICBpZiAocmVzLmNvbmZpcm0pIHtcbiAgICAgICAgICAgICAgICBlbC5zdGF0dXMgPSBcIjBcIjtcbiAgICAgICAgICAgICAgICBjb250ZXh0LnNob3dDdXIodGVtcCk7XG4gICAgICAgICAgICAgICAgd3guc2V0U3RvcmFnZSh7XG4gICAgICAgICAgICAgICAgICBrZXk6IFwibGlzdHNcIixcbiAgICAgICAgICAgICAgICAgIGRhdGE6IHRlbXAsXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGNvbnNvbGUubG9nKFwi5LiN5pON5L2cXCIpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG4gICAgY29uc29sZS5sb2coaXRlbSk7XG4gIH0sXG5cbiAgc2V0SW5wdXQ6IChlOiBhbnkpID0+IHtcbiAgICBjb250ZXh0LnNldERhdGEoe1xuICAgICAgYWRkVGV4dDogZS5kZXRhaWwudmFsdWUsXG4gICAgfSk7XG4gIH0sXG5cbiAgc2V0VXNlcjogKGU6IGFueSkgPT4ge1xuICAgIGNvbnRleHQuc2V0RGF0YSh7XG4gICAgICBhZGRVc2VySW5mbzogZS5kZXRhaWwudmFsdWUsXG4gICAgfSk7XG4gIH0sXG5cbiAgYWRkVXNlcjogKCkgPT4ge1xuICAgIGNvbnN0IGRiID0gd3guY2xvdWQuZGF0YWJhc2UoKTtcbiAgICBjb25zb2xlLmxvZyhjb250ZXh0LmRhdGEuYWRkVXNlckluZm8pO1xuICAgIGlmIChjb250ZXh0LmRhdGEuYWRkVXNlckluZm8gPT09IFwidGVzdCAyXCIpXG4gICAgICBkYi5jb2xsZWN0aW9uKFwidG9kb2xpc3RcIikuYWRkKHtcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgIG9wZW5pZDogY29udGV4dC5kYXRhLmFkZFVzZXJJbmZvLFxuICAgICAgICAgIGRvbmU6IHRydWUsXG4gICAgICAgICAgY3VyRGF5OiBjb250ZXh0LmRhdGEuY3VyRGF5LFxuICAgICAgICB9LFxuICAgICAgICBzdWNjZXNzOiAoKSA9PiB7XG4gICAgICAgICAgd3guc2hvd1RvYXN0KHtcbiAgICAgICAgICAgIHRpdGxlOiBcIumCgOivt+eggemqjOivgeaIkOWKn1wiLFxuICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuICAgICAgICAvLyDnhLblkI7pobXpnaLot7PovazliLDnmbvlvZXnirbmgIFcbiAgICAgIH0pO1xuICB9LFxuXG4gIHNob3dTdGF0dXM6IChlOiBhbnkpID0+IHtcbiAgICB2YXIgc3QgPSBlLmN1cnJlbnRUYXJnZXQuZGF0YXNldC5zdGF0dXM7XG4gICAgaWYgKGNvbnRleHQuZGF0YS5zdGF0dXMgPT09IHN0KSByZXR1cm47XG4gICAgaWYgKHN0ID09PSBcIjFcIikge1xuICAgICAgY29udGV4dC5zZXREYXRhKHtcbiAgICAgICAgc3RhdHVzOiBzdCxcbiAgICAgICAgY3VyTGlzdHM6IGNvbnRleHQuZGF0YS5saXN0cyxcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb250ZXh0LnNldERhdGEoe1xuICAgICAgc3RhdHVzOiBzdCxcbiAgICAgIGN1ckxpc3RzOiBjb250ZXh0LmRhdGEubGlzdHMuZmlsdGVyKFxuICAgICAgICAoaXRlbTogYW55KSA9PiAraXRlbS5zdGF0dXMgPT09IHN0IC0gMlxuICAgICAgKSxcbiAgICB9KTtcbiAgfSxcblxuICBkZWxUb2RvOiAoZTogYW55KSA9PiB7XG4gICAgbGV0IGl0ZW0gPSBlLmN1cnJlbnRUYXJnZXQuZGF0YXNldC5pdGVtO1xuICAgIGxldCB0ZW1wID0gY29udGV4dC5kYXRhLmxpc3RzO1xuICAgIHRlbXAuZm9yRWFjaCgoZWw6IGFueSwgaW5kZXg6IGFueSkgPT4ge1xuICAgICAgaWYgKGVsLmlkID09PSBpdGVtKSB7XG4gICAgICAgIHRlbXBbaW5kZXhdLnR4dFN0eWxlID0gXCJsZWZ0OjBcIjtcbiAgICAgICAgd3guc2hvd01vZGFsKHtcbiAgICAgICAgICB0aXRsZTogXCJcIixcbiAgICAgICAgICBjb250ZW50OiBcIuaCqOehruWumuimgeWIoOmZpOWQl++8n1wiLFxuICAgICAgICAgIGNvbmZpcm1UZXh0OiBcIuehruWumlwiLFxuICAgICAgICAgIGNhbmNlbFRleHQ6IFwi6ICD6JmR5LiA5LiLXCIsXG4gICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKHJlcykge1xuICAgICAgICAgICAgaWYgKHJlcy5jb25maXJtKSB7XG4gICAgICAgICAgICAgIHRlbXAuc3BsaWNlKGluZGV4LCAxKTtcbiAgICAgICAgICAgICAgY29udGV4dC5zaG93Q3VyKHRlbXApO1xuICAgICAgICAgICAgICB3eC5zZXRTdG9yYWdlKHtcbiAgICAgICAgICAgICAgICBrZXk6IFwibGlzdHNcIixcbiAgICAgICAgICAgICAgICBkYXRhOiB0ZW1wLFxuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIGNvbnRleHQuc2hvd0N1cih0ZW1wKTtcbiAgICAgICAgICAgICAgcmV0dXJuIGNvbnNvbGUubG9nKFwi5LiN5pON5L2cXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0pO1xuICB9LFxuXG4gIHRvdWNoUzogKGU6IGFueSkgPT4ge1xuICAgIC8vIGNvbnNvbGUubG9nKCflvIDlp4vvvJonICsgSlNPTi5zdHJpbmdpZnkoZSkpXG4gICAgLy8g5piv5ZCm5Y+q5pyJ5LiA5Liq6Kem5pG454K5XG4gICAgaWYgKGUudG91Y2hlcy5sZW5ndGggPT09IDEpIHtcbiAgICAgIGNvbnRleHQuc2V0RGF0YSh7XG4gICAgICAgIC8vIOinpuaRuOi1t+Wni+eahFjlnZDmoIdcbiAgICAgICAgc3RhcnRYOiBlLnRvdWNoZXNbMF0uY2xpZW50WCxcbiAgICAgIH0pO1xuICAgIH1cbiAgfSxcblxuICB0b3VjaE06IChlOiBhbnkpID0+IHtcbiAgICAvLyBjb25zb2xlLmxvZygn56e75Yqo77yaJyArIEpTT04uc3RyaW5naWZ5KGUpKVxuICAgIGlmIChlLnRvdWNoZXMubGVuZ3RoID09PSAxKSB7XG4gICAgICAvLyDop6bmkbjngrnnmoRY5Z2Q5qCHXG4gICAgICB2YXIgbW92ZVggPSBlLnRvdWNoZXNbMF0uY2xpZW50WDtcbiAgICAgIC8vIOiuoeeul+aJi+aMh+i1t+Wni+eCueeahFjlnZDmoIfkuI7lvZPliY3op6bmkbjngrnnmoRY5Z2Q5qCH55qE5beu5YC8XG4gICAgICB2YXIgZGlzWCA9IGNvbnRleHQuZGF0YS5zdGFydFggLSBtb3ZlWDtcbiAgICAgIC8vIGRlbEJ0bldpZHRoIOS4uuWPs+S+p+aMiemSruWMuuWfn+eahOWuveW6plxuICAgICAgdmFyIGRlbEJ0bldpZHRoID0gY29udGV4dC5kYXRhLmRlbEJ0bldpZHRoO1xuICAgICAgdmFyIHR4dFN0eWxlID0gXCJcIjtcbiAgICAgIGlmIChkaXNYID09IDAgfHwgZGlzWCA8IDApIHtcbiAgICAgICAgLy8g5aaC5p6c56e75Yqo6Led56a75bCP5LqO562J5LqOMO+8jOaWh+acrOWxguS9jee9ruS4jeWPmFxuICAgICAgICB0eHRTdHlsZSA9IFwibGVmdDowXCI7XG4gICAgICB9IGVsc2UgaWYgKGRpc1ggPiAwKSB7XG4gICAgICAgIC8vIOenu+WKqOi3neemu+Wkp+S6jjDvvIzmlofmnKzlsYJsZWZ05YC8562J5LqO5omL5oyH56e75Yqo6Led56a7XG4gICAgICAgIHR4dFN0eWxlID0gXCJsZWZ0Oi1cIiArIGRpc1ggKyBcInJweFwiO1xuICAgICAgICBpZiAoZGlzWCA+PSBkZWxCdG5XaWR0aCkge1xuICAgICAgICAgIC8vIOaOp+WItuaJi+aMh+enu+WKqOi3neemu+acgOWkp+WAvOS4uuWIoOmZpOaMiemSrueahOWuveW6plxuICAgICAgICAgIHR4dFN0eWxlID0gXCJsZWZ0Oi1cIiArIGRlbEJ0bldpZHRoICsgXCJycHhcIjtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgLy8g6I635Y+W5omL5oyH6Kem5pG455qE5piv5ZOq5LiA5LiqaXRlbVxuICAgICAgdmFyIGluZGV4ID0gZS5jdXJyZW50VGFyZ2V0LmRhdGFzZXQuaW5kZXg7XG4gICAgICB2YXIgbGlzdCA9IGNvbnRleHQuZGF0YS5jdXJMaXN0cztcbiAgICAgIC8vIOWwhuaLvOaOpeWlveeahOagt+W8j+iuvue9ruWIsOW9k+WJjWl0ZW3kuK1cbiAgICAgIGxpc3RbaW5kZXhdLnR4dFN0eWxlID0gdHh0U3R5bGU7XG4gICAgICAvLyDmm7TmlrDliJfooajnmoTnirbmgIFcbiAgICAgIGNvbnRleHQuc2V0RGF0YSh7XG4gICAgICAgIGN1ckxpc3RzOiBsaXN0LFxuICAgICAgfSk7XG4gICAgfVxuICB9LFxuXG4gIHRvdWNoRTogKGU6IGFueSkgPT4ge1xuICAgIC8vIGNvbnNvbGUubG9nKCflgZzmraLvvJonICsgSlNPTi5zdHJpbmdpZnkoZSkpXG4gICAgaWYgKGUuY2hhbmdlZFRvdWNoZXMubGVuZ3RoID09PSAxKSB7XG4gICAgICAvLyDmiYvmjIfnp7vliqjnu5PmnZ/lkI7op6bmkbjngrnkvY3nva7nmoRY5Z2Q5qCHXG4gICAgICB2YXIgZW5kWCA9IGUuY2hhbmdlZFRvdWNoZXNbMF0uY2xpZW50WDtcbiAgICAgIC8vIOinpuaRuOW8gOWni+S4jue7k+adn++8jOaJi+aMh+enu+WKqOeahOi3neemu1xuICAgICAgdmFyIGRpc1ggPSBjb250ZXh0LmRhdGEuc3RhcnRYIC0gZW5kWDtcbiAgICAgIHZhciBkZWxCdG5XaWR0aCA9IGNvbnRleHQuZGF0YS5kZWxCdG5XaWR0aDtcbiAgICAgIC8vIOWmguaenOi3neemu+Wwj+S6juWIoOmZpOaMiemSrueahDEvMu+8jOS4jeaYvuekuuWIoOmZpOaMiemSrlxuICAgICAgdmFyIHR4dFN0eWxlID1cbiAgICAgICAgZGlzWCA+IGRlbEJ0bldpZHRoIC8gMiA/IFwibGVmdDotXCIgKyBkZWxCdG5XaWR0aCArIFwicnB4XCIgOiBcImxlZnQ6MFwiO1xuICAgICAgLy8g6I635Y+W5omL5oyH6Kem5pG455qE5piv5ZOq5LiA6aG5XG4gICAgICB2YXIgaW5kZXggPSBlLmN1cnJlbnRUYXJnZXQuZGF0YXNldC5pbmRleDtcbiAgICAgIHZhciBsaXN0ID0gY29udGV4dC5kYXRhLmN1ckxpc3RzO1xuICAgICAgbGlzdFtpbmRleF0udHh0U3R5bGUgPSB0eHRTdHlsZTtcbiAgICAgIC8vIOabtOaWsOWIl+ihqOeahOeKtuaAgVxuICAgICAgY29udGV4dC5zZXREYXRhKHtcbiAgICAgICAgY3VyTGlzdHM6IGxpc3QsXG4gICAgICB9KTtcbiAgICB9XG4gIH0sXG59KTtcbiJdfQ==